Name of Casestudy : <%= @casestudy.tile %>
Duration of Casestudy <%= @casestudy.duration %>
Scale : <%= @casestudy.scale %>

<div id="clockdiv"></div>

<%= @deadline %>

<% @casestudy.pages.each do |p| %>

<%= p.body %>

<% end %>
<br>
<% @casestudy.questions.each do |q| %>
<br>
<td>
    <%= q.tile %>
    <%= render "user_responses/response_form", response: q.user_responses.find_by(user_id: current_user.id) %>
<td>
<% end %>

<%= link_to 'Submit answers', final_submit_path(@casestudy_user) %>

<script>
    const deadline = new Date("<%= @deadline %>");
    console.log(deadline)
    function getTimeRemaining(endtime){
        const total = Date.parse(endtime) - Date.parse(new Date());
        const seconds = Math.floor( (total/1000) % 60 );
        const minutes = Math.floor( (total/1000/60) % 60 );
        const hours = Math.floor( (total/(1000*60*60)) % 24 );
        const days = Math.floor( total/(1000*60*60*24) );

        return {
            total,
            days,
            hours,
            minutes,
            seconds
        };
    }


    function initializeClock(id, endtime){
        const clock = document.getElementById(id);
        const timeinterval = setInterval(() => {
            const t = getTimeRemaining(endtime);
            clock.innerHTML = t.days + ' days :' + t.hours + ' hours :' t.minutes + ' minutes :' + t.seconds + ' seconds'
            if (t.seconds % 30 === 0){
                const request = new XMLHttpRequest();
                request.open("post", "<%= update_time_path(@casestudy_user) %>");
                const token = document.querySelector('meta[name="csrf-token"]').content;
                request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                request.setRequestHeader("X-CSRF-Token", token);
                request.send(`time_elapsed=${t.total}`);
            }
            if (t.total <= 0){
                clearInterval(timeinterval);

                const request = new XMLHttpRequest();
                request.open("post", "<%= final_submit_path %>");
                const token = document.querySelector('meta[name="csrf-token"]').content;
                request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                request.setRequestHeader("X-CSRF-Token", token);
                request.send();
            }
        }, 1000);
    }
initializeClock('clockdiv', deadline);
</script>
